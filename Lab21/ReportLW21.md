# Отчет по лабораторной работе № 21
## по курсу "Фундаментальная информатика"

Студент группы М8О-108Б-23 Федорова Екатерина Васильевна

Работа выполнена 

Преподаватель: каф. 806 Севастьянов Виктор Сергеевич

1. **Тема**: Программирование на интерпретируемых командных языках
2. **Цель работы**: Составить программу выполнения заданных действий над файлами на одном из интерпретируемых командных языков OC UNIX (Shell, Cshell, Bash).
3. **Задание (вариант №22)**: Напиши программу, которая выполняет замену для всех файлов, имеющих размер меньше заданного, суффиксов имён на первые литеры имён файлов.

Дополнительные условия:
1. Если параметры опущены, они должны быть запрошены и пользователя.
3. Если указан параметр "?", то выводится подсказка (спецификация программы).
6. Программа должна обеспечивать возможность исправления значений параметров после запусков в диалоговом режиме.
8. Если параметры опущены, то устанавливаются некоторые стандартные значения параметров.

4. **Идея, метод, алгоритм решения задачи**:

Программа на Bash:

* принимаются параметры и передаются функциям
* modification() - функция принимает два аргумента: название директории и максимальный объём файла, после чего проходится по всей директории и, если размер файла меньше, меняет суффикс файла на его первую букву. Завершает программу.
* check() - функция, принимающая название директории и максимальный размер файла, проверяет директорию на существование и пустоту. Предлагает изменить параметры для корректной работы.
* confirmation() - функция, принимающая название директории и максимальный размер файла, подставляющая значения по умолчанию при некорректном вводе и запрашивающая подтверждение ввода. После этого переводит в main() или check().
* main() - функция считывания параметров, введённых при диалоговом режиме. Переводит в specification() или confirmation().
* specification() - функция, вызываемая параметром "?". Показывает спецификацию и предлагает перезапустить программу (вызвать main()) или завершить её.

  
5. **Тесты**: 

1. Закрытие программы через спецификацию.
```
moscow@moscow:~/Рабочий стол/For Labs/ForLabs/Lab21$ bash lab21.sh
Вы не указали директорию. По умолчанию взята текущая.
Вы не указали минимальный размер файла. По умолчанию взят 1 байт.
Выедены данные:
Директория: /home/moscow/Рабочий стол/For Labs/ForLabs/Lab21
Минимальный размер:  1
Желаете изменить введённые данные? [Да Yes|Нет No]
yes
________________
Введите имя директории (каталога) или '?' для помощи:
?
________________
Спецификация программы:
Программа находит файлы, размером меньше заданного, и меняет суффиксы их имён на первые литеры имён файлов.
 
Значения по умолчанию:
Имя дирректории: текущая;
Минимальный размер файла: 1 байт
 
Перезапустить программу? [Да Yes|Нет No]
No
Программа завершена.
```

2. Условия и проверка работы программы.
```
moscow@moscow:~/Рабочий стол/For Labs/ForLabs/Lab21$ bash lab21.sh ?
________________
Спецификация программы:
Программа находит файлы, размером меньше заданного, и меняет суффиксы их имён на первые литеры имён файлов.
 
Значения по умолчанию:
Имя дирректории: текущая;
Минимальный размер файла: 1 байт
 
Перезапустить программу? [Да Yes|Нет No]
Yes
________________
Введите имя директории (каталога) или '?' для помощи:
./Direc
Введите минимальный размер файла:
l
Вы не указали минимальный размер файла. По умолчанию взят 1 байт.
Выедены данные:
Директория: ./Direc
Минимальный размер:  1
Желаете изменить введённые данные? [Да Yes|Нет No]
yes
________________
Введите имя директории (каталога) или '?' для помощи:
kj
Введите минимальный размер файла:
7
Выедены данные:
Директория: kj
Минимальный размер:  7
Желаете изменить введённые данные? [Да Yes|Нет No]
No
Директории не существует или она пуста. Попробуйте снова.
________________
Введите имя директории (каталога) или '?' для помощи:
./Direc
Введите минимальный размер файла:
20
Выедены данные:
Директория: ./Direc
Минимальный размер:  20
Желаете изменить введённые данные? [Да Yes|Нет No]
No
Файл test2.txt переименован в test2.t
Файл exmas.c переименован в exmas.e
Файл example.md переименован в example.e
Программа завершена.
________________

```

3. Некорректный ответ на вопрос-подтверждение.
```
moscow@moscow:~/Рабочий стол/For Labs/ForLabs/Lab21$ bash lab21.sh ?
________________
Спецификация программы:
Программа находит файлы, размером меньше заданного, и меняет суффиксы их имён на первые литеры имён файлов.
 
Значения по умолчанию:
Имя дирректории: текущая;
Минимальный размер файла: 1 байт
 
Перезапустить программу? [Да Yes|Нет No]
длор
Введён некорректный ответ. Программа остановлена.
moscow@moscow:~/Рабочий стол/For Labs/ForLabs/Lab21$ bash lab21.sh
Вы не указали директорию. По умолчанию взята текущая.
Вы не указали минимальный размер файла. По умолчанию взят 1 байт.
Выедены данные:
Директория: /home/moscow/Рабочий стол/For Labs/ForLabs/Lab21
Минимальный размер:  1
Желаете изменить введённые данные? [Да Yes|Нет No]
лор
Введён некорректный ответ. Программа остановлена.

```

6. **Протокол**:
```
#!/bin/bash


# переименновывание файлов в директории
modification(){
    directory="$1"
    min_size="$2"
    
    find "$directory" -type f | while read file; do
        size=$(stat -c %s "$file")
        if [ -f "$file" ] && [ $size -lt $min_size ]; then
            file_name="${file%.*}"
            extension=$(basename "$file" | head -c 1)
            new_name="${file_name}.${extension}"
            mv "$file" "$new_name"
            echo "Файл $(basename "$file") переименован в $(basename "$new_name")"
        fi
    done
    echo "Программа завершена."
    echo "________________"
    exit 1       
}


# проверка существования и пустоты директории
check(){
    directory="$1"
    min_size="$2"
    
    if [ ! -d "$directory" ] || [ -n "$(find "$directory" -maxdepth 0 -empty)" ]; then
        echo "Директории не существует или она пуста. Попробуйте снова."
        echo "________________"
        main
    else
        modification "$directory" "$min_size"
    fi
}


# подтверждение введённых данных
confirmation(){
    directory="$1"
    min_size="$2"
    
    # проверка данных и установка их по умолчанию
    if [ -z "$directory" ]; then
        echo "Вы не указали директорию. По умолчанию взята текущая."
        directory=$(pwd)
    fi
    if [ "$directory" == "?" ]; then
        specification
    fi
    REGEX="^[0-9]+$"
    if [ -z "$min_size" ] || [[ ! $min_size =~ $REGEX ]]; then
        echo "Вы не указали минимальный размер файла. По умолчанию взят 1 байт."
        min_size=1
    fi
    
    # запрос подтверждения
    echo "Выедены данные:"
    echo "Директория: $directory"
    echo "Минимальный размер: " $min_size
    echo "Желаете изменить введённые данные? [Да Yes|Нет No]"
    read restart
    if [ "$restart" == "Да" ] || [ "$restart" == "да" ] || [ "$restart" == "Yes" ] || [ "$restart" == "yes" ]; then
        echo "________________"
        main
    else
        if [ "$restart" == "Нет" ] || [ "$restart" == "нет" ] || [ "$restart" == "No" ] || [ "$restart" == "no" ]; then
            check "$directory" "$min_size"
        else
            echo "Введён некорректный ответ. Программа остановлена."
            exit 0
        fi
    fi
}


# считывание данных
main(){
    echo "Введите имя директории (каталога) или '?' для помощи:"
    read directory
    if [ "$directory" == "?" ]; then
        specification
    else
        echo "Введите минимальный размер файла:"
        read min_size
        confirmation "$directory" "$min_size"
    fi
}


# начальное окно и вывод спецификации
specification(){
    echo "________________"
    echo "Спецификация программы:"
    echo "Программа находит файлы, размером меньше заданного, и меняет суффиксы их имён на первые литеры имён файлов."
    echo " "
    echo "Значения по умолчанию:"
    echo "Имя дирректории: текущая;"
    echo "Минимальный размер файла: 1 байт"
    echo " "
    echo "Перезапустить программу? [Да Yes|Нет No]"
    read restart
    if [ "$restart" == "Да" ] || [ "$restart" == "да" ] || [ "$restart" == "Yes" ] || [ "$restart" == "yes" ]; then
        echo "________________"
        main
    else
        if [ "$restart" == "Нет" ] || [ "$restart" == "нет" ] || [ "$restart" == "No" ] || [ "$restart" == "no" ]; then
            echo "Программа завершена."
            exit 0
        else
            echo "Введён некорректный ответ. Программа остановлена."
            exit 0
        fi
    fi
}


# запуск программы
confirmation "$1" "$2"
```

7. **Замечания автора** по существу работы: -.
9. **Выводы**: В процессе работы научились писать код на Bash. В начале возникли сложности с привыканием к новому синтаксису и при поиске требуемых функций. Также не сразу поняла ТЗ.
Полученные знания помогут структурно мыслить, в ходе выполнения стала более усидчивой и терпеливой.
